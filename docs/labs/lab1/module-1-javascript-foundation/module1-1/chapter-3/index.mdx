# Chapter 3: Functions — Normal & Arrow

สำหรับผู้เริ่มต้นที่ยังไม่ถนัดโค้ด ให้คิดว่า “ฟังก์ชัน” คือเครื่องมือที่เก็บขั้นตอนทำงานไว้ในที่เดียว เรียกใช้เมื่อไรก็ได้ ลดการเขียนซ้ำ และทำให้โค้ดอ่านง่ายขึ้น

---

## ทำไมต้องใช้ฟังก์ชัน?
- เขียนครั้งเดียว ใช้ซ้ำได้
- ตั้งชื่ออธิบายงาน ทำให้โค้ดสื่อความหมาย
- แยกปัญหาเป็นชิ้นเล็ก ๆ ง่ายต่อการแก้บั๊ก

---

## ฟังก์ชันแบบปกติ (Normal function)

```js
function addPrice(price, vatRate) {
  const vat = price * vatRate;
  return price + vat;
}

const total = addPrice(100, 0.07);
console.log(total); // 107
```

- สร้างด้วย `function`
- มี `return` เพื่อส่งผลลัพธ์ออกไป ถ้าไม่ใส่จะคืน `undefined`

### รับอาร์กิวเมนต์และตั้งค่าเริ่มต้น
```js
function greet(name = "Guest") {
  console.log(`Hello, ${name}!`);
}

greet();          // Hello, Guest!
greet("Alice");   // Hello, Alice!
```

- ถ้าไม่ส่งอาร์กิวเมนต์มา ค่านั้นจะเป็น `undefined`
- ตำแหน่งที่มีค่า default จะใช้ค่าที่ตั้งไว้หากไม่ส่งมา

### รับหลายอาร์กิวเมนต์แบบ rest
```js
function sumAll(...numbers) {
  // numbers เป็น array
  return numbers.reduce((acc, n) => acc + n, 0);
}

sumAll(1, 2, 3); // 6
sumAll(5);       // 5
```

### ตั้งชื่ออาร์กิวเมนต์ให้สื่อความหมาย (ตัวอย่างรูปแบบ object)
```js
function createUser({ name, role = "member" }) {
  return { name, role };
}

createUser({ name: "Beam" });           // role จะเป็น "member"
createUser({ name: "Fah", role: "admin" });
```
เขียนแบบนี้ช่วยจำได้ว่าอาร์กิวเมนต์แต่ละตัวคืออะไร และตั้ง default รายจุดได้

---

## ฟังก์ชันแบบ Arrow (Arrow function)

```js
const addPriceArrow = (price, vatRate) => {
  const vat = price * vatRate;
  return price + vat;
};
```

### รูปย่อ (ถ้ามีบรรทัดเดียวและ return ทันที)
```js
const plusOne = (n) => n + 1;
const isFree = (price) => price === 0;
```

### รูปย่อเมื่อมีพารามิเตอร์เดียว
```js
const shout = word => word.toUpperCase();
```

---

## ความต่างสำคัญระหว่าง Normal vs Arrow
- `this`: Arrow ไม่สร้าง `this` ใหม่ จะใช้ `this` ของบริบทข้างนอก ส่วน normal มี `this` ของตัวมันเอง  
  (สำหรับผู้เริ่มต้น ให้จำว่าใน callback เรามักใช้ arrow เพื่อเลี่ยงสับสน `this`)
- `arguments`: Normal มีตัวแปรพิเศษ `arguments` ที่รวมทุกอาร์กิวเมนต์ Arrow ไม่มี ต้องใช้ rest (…) แทน
- ใช้เป็น Method: ใน object เรามักใช้ฟังก์ชันปกติเป็น method เพื่อให้ `this` ชี้ถูกตัว

---

## ใช้ฟังก์ชันกับ Array (ตัวอย่างที่เห็นบ่อยใน Node.js)

```js
const prices = [50, 80, 120];

// map: แปลงทีละตัว
const withVat = prices.map((price) => price * 1.07);

// filter: คัดเลือก
const premium = prices.filter((price) => price > 100);

// reduce: รวมค่า
const sum = prices.reduce((acc, price) => acc + price, 0);

console.log(withVat);
console.log(premium);
console.log(sum);
```

---

## ตัวอย่าง: สั่งกาแฟร้าน KCode

```js
function calcTotal(menu, vatRate) {
  let total = 0;
  for (const item of menu) {
    total += item.price * item.qty;
  }
  return total * (1 + vatRate);
}

const menu = [
  { name: "Latte", price: 55, qty: 1 },
  { name: "Mocha", price: 65, qty: 2 },
];

const totalWithVat = calcTotal(menu, 0.07);
console.log(`ยอดรวม (รวม VAT): ${totalWithVat}`);
```

---

# Lab — ฝึกเขียนฟังก์ชัน
1) สร้างฟังก์ชันปกติ `calcVat(price, vatRate)` คืนราคาพร้อม VAT  
2) สร้างฟังก์ชัน arrow `formatPrice(price)` ให้คืนสตริงเช่น `"55 บาท"`  
3) ใช้ `map` กับราคาหลายรายการแล้วแปลงเป็นราคาพร้อม VAT  
4) ใช้ `filter` คัดราคาที่เกิน 100 บาท  
5) (เสริม) ทดลองเปรียบเทียบ `this` ใน method ของ object ระหว่างฟังก์ชันปกติและ arrow แล้วสังเกตผลลัพธ์
